<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KlangFarben ‚Äì Impressionen</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#7c4dff; --text:#e6eef7;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;}
  body{background:linear-gradient(180deg,#071227 0%, #0b1726 100%);color:var(--text);display:flex;align-items:flex-start;justify-content:center;padding:28px;}
  .container{width:100%;max-width:980px;}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  h1{margin:0;font-size:20px;letter-spacing:0.2px}
  .subtitle{color:var(--muted);font-size:13px;margin-top:4px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
  .player-row{display:flex;gap:14px;align-items:center}
  .video-wrap{flex:0 0 500px;height:80px;max-width:100%}
  .video-wrap iframe{width:100%;height:100%;border-radius:8px;border:0;background:#000}
  .controls{flex:1;display:flex;flex-direction:column;gap:10px}
  .big-controls{display:flex;gap:10px;align-items:center}
  .player-container{
    display: inline-block;
    min-width: 50%;
  }
  button{
      background: transparent;
      border: 1px solid rgba(255,255,255,0.06);
      color: var(--text);
      width: 46px;
      height: 46px;
      border-radius: 10px;
      font-size: 20px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
  }
  button.primary{
    background: linear-gradient(90deg,var(--accent),#00c4ff);
    border: none;
    color: #071227;
    font-weight: 600;
  }
  button.jump{
    background: linear-gradient(90deg,#3d0069,#2d93e0,#ffffff);
    border: none;
    color: #071227;
    font-weight: 600;
    width: 70px;
    margin-left: 40px;
  }
  .track-list{margin-top:14px;display:flex;gap:12px}
  .list{background:rgba(255,255,255,0.02);border-radius:10px;padding:10px;flex:1;max-height:360px;overflow:auto}
  .track{padding:10px;border-radius:8px;display:flex;gap:12px;align-items:center;cursor:pointer}
  .track:hover{background:rgba(255,255,255,0.02)}
  .track .idx{width:28px;text-align:center;color:var(--muted);font-size:13px}
  .track .title{font-size:14px}
  .track.active{background:linear-gradient(90deg, rgba(124,77,255,0.6), rgba(0,196,255,0.4));box-shadow:0 4px 14px rgba(12,8,32,0.6)}
  footer{margin-top:10px;color:var(--muted);font-size:13px}
  @media (max-width:640px){
    .player-row{flex-direction:column;align-items:stretch}
    .video-wrap{height:64px;flex-basis:auto}
    .controls{order:2}
  }
  footer a {
    background: linear-gradient(90deg,#7c4dff70,#00c4ff70);
    border: none;
    color: #EEEEEE;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    line-height: 1;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 12px;
    display: inline-flex;
    text-decoration: none;
  }
  footer a:hover,
  footer a:focus {
    color: #ffcc00;          /* highlight on hover/focus */
    text-decoration: underline;
  }

  .track-info{
    color: #AAAAAA;
    font-size: 14px;
    align-items: center;
    justify-content: center;
    padding-top: 6px;
    padding-left: 8px;
    padding-right: 8px;
    display: inline-flex;
  }
  .source-link{
    color: #AAAAAA;
    font-size: 18px;
    text-decoration: none;
    padding: 0px 4px;
    border: 1px solid #AAAAAA;
    border-radius: 6px;
    transition: all 0.2s;
  }

  .banner-container{
    position:relative;
    display:block;
    max-width:100%;
    width:fit-content;
  }
  .banner-container img{
    max-width:100%;
    height:auto;
    display:block;
  }
  .subtitle{
    position:absolute;
    bottom:16px;
    left:16px;
    background:rgba(0,0,0,0.7);
    color:white;
    padding:12px 20px;
    border-radius:10px;
    font-size:14px;
    font-weight:600;
    backdrop-filter:blur(8px);
    display:flex;
    gap: 10px;
  }
  .back-to-index{
    position:absolute;
    top:16px;
    right:16px;
    background:rgba(0,0,0,0.7);
    color:white;
    padding:12px 20px;
    border-radius:10px;
    font-size:14px;
    font-weight:600;
    backdrop-filter:blur(8px);
    text-decoration: none;
  }
  .download-button{
    background: transparent;
    border: none;
    color: #FFFFFF;
    font-size: 20px;
    font-weight: 600;
    line-height: 1;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    display: inline-flex;
  }
  .download-icon {
    width: 16px;
    height: 16px;
    color: #000000;
  }

</style>
</head>
<body>
  <div class="banner-container">
    <header>
      <div class="banner-container">
        <img src="Banner.jpg" alt="KlangFarben">
        <div class="subtitle">
          Impressionen
          
<a href="impressionen-download.html" class="download-button" aria-label="Download">
    <svg class="download-icon" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="2">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
      <polyline points="7 10 12 15 17 10"></polyline>
      <line x1="12" y1="15" x2="12" y2="3"></line>
    </svg>
</a>

        </div>
        <a href="index.html" class="back-to-index">Andere Playlists</a>
      </div>
    </header>

    <div class="card">
      <div class="player-row">
        <div class="player-container">
          <div class="video-wrap" id="video-wrap">
            <div id="player-container"></div>
          </div>
          <div id="trackInfo" class="track-info">No track selected.</div>
        </div>
        <div class="controls">
          <div class="big-controls">
            <button id="prevBtn">‚èÆ</button>
            <button id="playBtn" class="primary">‚ñ∂</button>
            <button id="nextBtn">‚è≠</button>
<!--            <button id="travelBtn" class="jump">üöÄ ‚è≠</button>-->
            <div style="margin-left:auto;color:var(--muted);font-size:13px" id="timeLabel">‚Äî</div>
          </div>
          <div class="track-list">
            <div class="list" id="trackList"></div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>Impressum: Philipp Holl ‚Äì philipp@mholl.de</p>
    </footer>
  </div>

<script>
const PLAYLIST = {
  "majorVersion": 14,
  "minorVersion": 1,
  "tracks": [
    {
      "name": "Walk In The Park Full \u2022 Audionautix",
      "full": "Walk In The Park Full \u2022 Audionautix",
      "url": "audio/impressionen/001 audionautix - walk-in-the-park-full.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Tuesday Night \u2022 Amarent",
      "full": "Tuesday Night \u2022 Amarent",
      "url": "audio/impressionen/002 amarent - tuesday-night.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/amarent/free-atmospheric-music/tuesday-night/"
    },
    {
      "name": "The Rule \u2022 Kevin MacLeod",
      "full": "The Rule \u2022 Kevin MacLeod",
      "url": "audio/impressionen/003 kevin-macleod - the-rule.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/Kevin_MacLeod/Classical_Sampler/The_Rule/"
    },
    {
      "name": "Tayata Om Bekanze Chant \u2022 John Lopker",
      "full": "Tayata Om Bekanze Chant \u2022 John Lopker",
      "url": "audio/impressionen/004 john-lopker - tayata-om-bekanze-chant.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/john-lopker/meditation-chants/tayata-om-bekanze-chant/"
    },
    {
      "name": "Monkeys Spinning Monkeys \u2022 Kevin MacLeod",
      "full": "Monkeys Spinning Monkeys \u2022 Kevin MacLeod",
      "url": "audio/impressionen/005 kevin-macleod - monkeys-spinning-monkeys.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1400011&Search=Search"
    },
    {
      "name": "Smoke In The Backroom \u2022 KlangFarben",
      "full": "Smoke In The Backroom \u2022 KlangFarben",
      "url": "audio/impressionen/006 klangfarben - smoke-in-the-backroom.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Fuego del Coraz\u00f3n \u2022 KlangFarben",
      "full": "Fuego del Coraz\u00f3n \u2022 KlangFarben",
      "url": "audio/impressionen/007 klangfarben - fuego-del-coraz-n.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Sunrise On Mars \u2022 Audionautix",
      "full": "Sunrise On Mars \u2022 Audionautix",
      "url": "audio/impressionen/008 audionautix - sunrise-on-mars.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Local Elevator - Elevator \u2022 Kevin MacLeod",
      "full": "Local Elevator - Elevator \u2022 Kevin MacLeod",
      "url": "audio/impressionen/009 kevin-macleod - local-elevator-elevator.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1300012"
    },
    {
      "name": "ROCKY TOP \u2022 Jason Shaw",
      "full": "ROCKY TOP \u2022 Jason Shaw",
      "url": "audio/impressionen/010 jason-shaw - rocky-top.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/Jason_Shaw/Audionautix_Acoustic/ROCKY_TOP_traditional__1-44/"
    },
    {
      "name": "Velvet Staircase \u2022 KlangFarben",
      "full": "Velvet Staircase \u2022 KlangFarben",
      "url": "audio/impressionen/011 klangfarben - velvet-staircase.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Lorn \u2022 GalaxyTones",
      "full": "Lorn \u2022 GalaxyTones",
      "url": "audio/impressionen/012 galaxytones - lorn.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.audiolibrary.com.co/galaxytones/lorn"
    },
    {
      "name": "Cattails \u2022 Kevin MacLeod",
      "full": "Cattails \u2022 Kevin MacLeod",
      "url": "audio/impressionen/013 kevin-macleod - cattails.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/Kevin_MacLeod/Contemporary_Sampler/Cattails/"
    },
    {
      "name": "Hitman \u2022 Kevin MacLeod",
      "full": "Hitman \u2022 Kevin MacLeod",
      "url": "audio/impressionen/014 kevin-macleod - hitman.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1300013"
    },
    {
      "name": "Crystal Steps Beneath the Glacier \u2022 KlangFarben",
      "full": "Crystal Steps Beneath the Glacier \u2022 KlangFarben",
      "url": "audio/impressionen/015 klangfarben - crystal-steps-beneath-the-glacier.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Super Saturday Squad \u2022 KlangFarben",
      "full": "Super Saturday Squad \u2022 KlangFarben",
      "url": "audio/impressionen/016 klangfarben - super-saturday-squad.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "First Place \u2022 KlangFarben",
      "full": "First Place \u2022 KlangFarben",
      "url": "audio/impressionen/017 klangfarben - first-place.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Infinite Solutions \u2022 KlangFarben",
      "full": "Infinite Solutions \u2022 KlangFarben",
      "url": "audio/impressionen/018 klangfarben - infinite-solutions.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Synthetic Getaway \u2022 KlangFarben",
      "full": "Synthetic Getaway \u2022 KlangFarben",
      "url": "audio/impressionen/019 klangfarben - synthetic-getaway.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Enchanted Canopy \u2022 KlangFarben",
      "full": "Enchanted Canopy \u2022 KlangFarben",
      "url": "audio/impressionen/020 klangfarben - enchanted-canopy.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Beyond All Horizons \u2022 KlangFarben",
      "full": "Beyond All Horizons \u2022 KlangFarben",
      "url": "audio/impressionen/021 klangfarben - beyond-all-horizons.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Moonlight Hall \u2022 Kevin MacLeod",
      "full": "Moonlight Hall \u2022 Kevin MacLeod",
      "url": "audio/impressionen/022 kevin-macleod - moonlight-hall.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1200095"
    },
    {
      "name": "Anthem of the Silver Crown \u2022 KlangFarben",
      "full": "Anthem of the Silver Crown \u2022 KlangFarben",
      "url": "audio/impressionen/023 klangfarben - anthem-of-the-silver-crown.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Lost in the Mist \u2022 KlangFarben",
      "full": "Lost in the Mist \u2022 KlangFarben",
      "url": "audio/impressionen/024 klangfarben - lost-in-the-mist.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Cambodean Odessy \u2022 Kevin MacLeod",
      "full": "Cambodean Odessy \u2022 Kevin MacLeod",
      "url": "audio/impressionen/025 kevin-macleod - cambodean-odessy.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/Kevin_MacLeod/Global_Sampler/Cambodian_Odyssey/"
    },
    {
      "name": "Inhale \u2022 Horner",
      "full": "Inhale \u2022 Johnathon M. Horner",
      "url": "audio/impressionen/026 johnathon-m-horner - inhale.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/beat-mekanik/single/inhale/"
    },
    {
      "name": "The Visitors \u2022 Audionautix",
      "full": "The Visitors \u2022 Audionautix",
      "url": "audio/impressionen/027 audionautix - the-visitors.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Run of the Winter Sky \u2022 KlangFarben",
      "full": "Run of the Winter Sky \u2022 KlangFarben",
      "url": "audio/impressionen/028 klangfarben - run-of-the-winter-sky.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Cool Vibes \u2022 Kevin MacLeod",
      "full": "Cool Vibes \u2022 Kevin MacLeod",
      "url": "audio/impressionen/029 kevin-macleod - cool-vibes.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100863"
    },
    {
      "name": "Fluffing a Duck \u2022 Kevin MacLeod",
      "full": "Fluffing a Duck \u2022 Kevin MacLeod",
      "url": "audio/impressionen/030 kevin-macleod - fluffing-a-duck.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100768"
    },
    {
      "name": "Exotica \u2022 KlangFarben",
      "full": "Exotica \u2022 KlangFarben",
      "url": "audio/impressionen/031 klangfarben - exotica.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Hip Hop Christmas \u2022 Twin Musicom",
      "full": "Hip Hop Christmas \u2022 Twin Musicom",
      "url": "audio/impressionen/032 twin-musicom - hip-hop-christmas.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.audiolibrary.com.co/twin-musicom/hip-hop-christmas"
    },
    {
      "name": "Morning Of The Quest \u2022 KlangFarben",
      "full": "Morning Of The Quest \u2022 KlangFarben",
      "url": "audio/impressionen/033 klangfarben - morning-of-the-quest.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Prelude No. 23 \u2022 Chris Zabriskie",
      "full": "Prelude No. 23 \u2022 Chris Zabriskie",
      "url": "audio/impressionen/034 chris-zabriskie - prelude-no-23.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "The Coal Mine \u2022 Twin Musicom",
      "full": "The Coal Mine \u2022 Twin Musicom",
      "url": "audio/impressionen/035 twin-musicom - the-coal-mine.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Whispers of the Koto \u2022 KlangFarben",
      "full": "Whispers of the Koto \u2022 KlangFarben",
      "url": "audio/impressionen/036 klangfarben - whispers-of-the-koto.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Tidal Static \u2022 KlangFarben",
      "full": "Tidal Static \u2022 KlangFarben",
      "url": "audio/impressionen/037 klangfarben - tidal-static.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Crinoline Dreams \u2022 Kevin MacLeod",
      "full": "Crinoline Dreams \u2022 Kevin MacLeod",
      "url": "audio/impressionen/038 kevin-macleod - crinoline-dreams.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1700073"
    },
    {
      "name": "Pillars of Light \u2022 KlangFarben",
      "full": "Pillars of Light \u2022 KlangFarben",
      "url": "audio/impressionen/039 klangfarben - pillars-of-light.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Manic Polka \u2022 Kevin MacLeod",
      "full": "Manic Polka \u2022 Kevin MacLeod",
      "url": "audio/impressionen/040 kevin-macleod - manic-polka.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100168"
    },
    {
      "name": "Foam and Fiddle Fireside \u2022 KlangFarben",
      "full": "Foam and Fiddle Fireside \u2022 KlangFarben",
      "url": "audio/impressionen/041 klangfarben - foam-and-fiddle-fireside.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Arcadia \u2022 Kevin MacLeod",
      "full": "Arcadia \u2022 Kevin MacLeod",
      "url": "audio/impressionen/042 kevin-macleod - arcadia.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100326"
    },
    {
      "name": "Harley Davidson \u2022 Horner",
      "full": "Harley Davidson \u2022 Johnathon M. Horner",
      "url": "audio/impressionen/043 johnathon-m-horner - harley-davidson.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/beat-mekanik/single/harley-davidson/"
    },
    {
      "name": "Eclipse Over Eden \u2022 KlangFarben",
      "full": "Eclipse Over Eden \u2022 KlangFarben",
      "url": "audio/impressionen/044 klangfarben - eclipse-over-eden.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Gravities Collide \u2022 KlangFarben",
      "full": "Gravities Collide \u2022 KlangFarben",
      "url": "audio/impressionen/045 klangfarben - gravities-collide.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Christmas In My Heart \u2022 Alex-Productions",
      "full": "Christmas In My Heart \u2022 Alex-Productions",
      "url": "audio/impressionen/046 alex-productions - christmas-in-my-heart.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.audiolibrary.com.co/alex-productions/christmas-in-my-heart"
    },
    {
      "name": "\u5c71\u98a8\u5165\u5922 \u2022 KlangFarben",
      "full": "\u5c71\u98a8\u5165\u5922 \u2022 KlangFarben",
      "url": "audio/impressionen/047 klangfarben - .mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Static in My Laces \u2022 KlangFarben",
      "full": "Static in My Laces \u2022 KlangFarben",
      "url": "audio/impressionen/048 klangfarben - static-in-my-laces.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Forgotten Toys \u2022 KlangFarben",
      "full": "Forgotten Toys \u2022 KlangFarben",
      "url": "audio/impressionen/049 klangfarben - forgotten-toys.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Beach Party \u2022 Kevin MacLeod",
      "full": "Beach Party \u2022 Kevin MacLeod",
      "url": "audio/impressionen/050 kevin-macleod - beach-party.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100613&Search=Search"
    },
    {
      "name": "Starfire Descent \u2022 KlangFarben",
      "full": "Starfire Descent \u2022 KlangFarben",
      "url": "audio/impressionen/051 klangfarben - starfire-descent.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Industrial Music Box \u2022 Kevin MacLeod",
      "full": "Industrial Music Box \u2022 Kevin MacLeod",
      "url": "audio/impressionen/052 kevin-macleod - industrial-music-box.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100812"
    },
    {
      "name": "Sunrise in the Garden \u2022 KlangFarben",
      "full": "Sunrise in the Garden \u2022 KlangFarben",
      "url": "audio/impressionen/053 klangfarben - sunrise-in-the-garden.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Off to Osaka \u2022 Kevin MacLeod",
      "full": "Off to Osaka \u2022 Kevin MacLeod",
      "url": "audio/impressionen/054 kevin-macleod - off-to-osaka.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/Kevin_MacLeod/Jazz_Sampler/Off_to_Osaka/"
    },
    {
      "name": "Chrome Cathedral \u2022 KlangFarben",
      "full": "Chrome Cathedral \u2022 KlangFarben",
      "url": "audio/impressionen/055 klangfarben - chrome-cathedral.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Accord\u00e9ons et Promesses \u2022 KlangFarben",
      "full": "Accord\u00e9ons et Promesses \u2022 KlangFarben",
      "url": "audio/impressionen/056 klangfarben - accord-ons-et-promesses.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Still Water \u2022 KlangFarben",
      "full": "Still Water (Slow Breath) \u2022 KlangFarben",
      "url": "audio/impressionen/057 klangfarben - still-water.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Drunk On The Devil\u2019s Gold \u2022 KlangFarben",
      "full": "Drunk On The Devil\u2019s Gold \u2022 KlangFarben",
      "url": "audio/impressionen/058 klangfarben - drunk-on-the-devil-s-gold.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Basement Cypher \u2022 KlangFarben",
      "full": "Basement Cypher \u2022 KlangFarben",
      "url": "audio/impressionen/059 klangfarben - basement-cypher.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Tempting Fate \u2022 Audionautix",
      "full": "Tempting Fate \u2022 Audionautix",
      "url": "audio/impressionen/060 audionautix - tempting-fate.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Unfoldment \u2022 Chris Zabriskie",
      "full": "Unfoldment (Revealment, Evolution, Exposition, Integration) \u2022 Chris Zabriskie",
      "url": "audio/impressionen/061 chris-zabriskie - unfoldment.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Brass section \u2022 KlangFarben",
      "full": "Brass section \u2022 KlangFarben",
      "url": "audio/impressionen/062 klangfarben - brass-section.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Shining Star \u2022 KlangFarben",
      "full": "Shining Star \u2022 KlangFarben",
      "url": "audio/impressionen/063 klangfarben - shining-star.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Grey Umbrellas \u2022 KlangFarben",
      "full": "Grey Umbrellas \u2022 KlangFarben",
      "url": "audio/impressionen/064 klangfarben - grey-umbrellas.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Investigations \u2022 Kevin MacLeod",
      "full": "Investigations \u2022 Kevin MacLeod",
      "url": "audio/impressionen/065 kevin-macleod - investigations.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100646"
    },
    {
      "name": "Tropical Nocturne \u2022 KlangFarben",
      "full": "Tropical Nocturne \u2022 KlangFarben",
      "url": "audio/impressionen/066 klangfarben - tropical-nocturne.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Midnight Corridor \u2022 KlangFarben",
      "full": "Midnight Corridor \u2022 KlangFarben",
      "url": "audio/impressionen/067 klangfarben - midnight-corridor.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Pink Soul \u2022 Horner",
      "full": "Pink Soul \u2022 Johnathon M. Horner",
      "url": "audio/impressionen/068 johnathon-m-horner - pink-soul.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/beat-mekanik/single/pink-soul/"
    },
    {
      "name": "Colossus in Slow Motion \u2022 KlangFarben",
      "full": "Colossus in Slow Motion \u2022 KlangFarben",
      "url": "audio/impressionen/069 klangfarben - colossus-in-slow-motion.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Carefree \u2022 Kevin MacLeod",
      "full": "Carefree \u2022 Kevin MacLeod",
      "url": "audio/impressionen/070 kevin-macleod - carefree.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1400037"
    },
    {
      "name": "Soft Static in My Head \u2022 KlangFarben",
      "full": "Soft Static in My Head \u2022 KlangFarben",
      "url": "audio/impressionen/071 klangfarben - soft-static-in-my-head.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Quiet Turning \u2022 KlangFarben",
      "full": "Quiet Turning \u2022 KlangFarben",
      "url": "audio/impressionen/072 klangfarben - quiet-turning.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Words \u2022 Audionautix",
      "full": "Words \u2022 Audionautix",
      "url": "audio/impressionen/073 audionautix - words.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Plastic Sunset Mall \u2022 KlangFarben",
      "full": "Plastic Sunset Mall \u2022 KlangFarben",
      "url": "audio/impressionen/074 klangfarben - plastic-sunset-mall.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Crimson Tides Arise \u2022 KlangFarben",
      "full": "Crimson Tides Arise \u2022 KlangFarben",
      "url": "audio/impressionen/075 klangfarben - crimson-tides-arise.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Clockwork Stars \u2022 KlangFarben",
      "full": "Clockwork Stars \u2022 KlangFarben",
      "url": "audio/impressionen/076 klangfarben - clockwork-stars.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Parisian \u2022 Kevin MacLeod",
      "full": "Parisian \u2022 Kevin MacLeod",
      "url": "audio/impressionen/077 kevin-macleod - parisian.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/Kevin_MacLeod/Global_Sampler/Parisian/"
    },
    {
      "name": "Amazing Plan \u2022 Kevin MacLeod",
      "full": "Amazing Plan \u2022 Kevin MacLeod",
      "url": "audio/impressionen/078 kevin-macleod - amazing-plan.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100737"
    },
    {
      "name": "I Am a Man Who Will Fight for Your Honor \u2022 Chris Zabriskie",
      "full": "I Am a Man Who Will Fight for Your Honor \u2022 Chris Zabriskie",
      "url": "audio/impressionen/079 chris-zabriskie - i-am-a-man-who-will-fight-for-your-honor.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Crown of Morning Voices \u2022 KlangFarben",
      "full": "Crown of Morning Voices \u2022 KlangFarben",
      "url": "audio/impressionen/080 klangfarben - crown-of-morning-voices.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Subway Cathedral \u2022 KlangFarben",
      "full": "Subway Cathedral \u2022 KlangFarben",
      "url": "audio/impressionen/081 klangfarben - subway-cathedral.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Ash in the Orchard \u2022 KlangFarben",
      "full": "Ash in the Orchard \u2022 KlangFarben",
      "url": "audio/impressionen/082 klangfarben - ash-in-the-orchard.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Night Shift Circuit \u2022 KlangFarben",
      "full": "Night Shift Circuit \u2022 KlangFarben",
      "url": "audio/impressionen/083 klangfarben - night-shift-circuit.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Under Baobab Skies \u2022 KlangFarben",
      "full": "Under Baobab Skies \u2022 KlangFarben",
      "url": "audio/impressionen/084 klangfarben - under-baobab-skies.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Sneaky Snitch \u2022 Kevin MacLeod",
      "full": "Sneaky Snitch \u2022 Kevin MacLeod",
      "url": "audio/impressionen/085 kevin-macleod - sneaky-snitch.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100772"
    },
    {
      "name": "Tennessee Hayride \u2022 Audionautix",
      "full": "Tennessee Hayride \u2022 Audionautix",
      "url": "audio/impressionen/086 audionautix - tennessee-hayride.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Shadows in the Hall \u2022 KlangFarben",
      "full": "Shadows in the Hall \u2022 KlangFarben",
      "url": "audio/impressionen/087 klangfarben - shadows-in-the-hall.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Sky Wide Open \u2022 KlangFarben",
      "full": "Sky Wide Open \u2022 KlangFarben",
      "url": "audio/impressionen/088 klangfarben - sky-wide-open.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Mermaid \u2022 Kevin MacLeod",
      "full": "Mermaid \u2022 Kevin MacLeod",
      "url": "audio/impressionen/089 kevin-macleod - mermaid.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100671"
    },
    {
      "name": "Sunny Pathways \u2022 KlangFarben",
      "full": "Sunny Pathways \u2022 KlangFarben",
      "url": "audio/impressionen/090 klangfarben - sunny-pathways.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Dead Wires In My Heart \u2022 KlangFarben",
      "full": "Dead Wires In My Heart \u2022 KlangFarben",
      "url": "audio/impressionen/091 klangfarben - dead-wires-in-my-heart.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Dust On My Notebook \u2022 KlangFarben",
      "full": "Dust On My Notebook \u2022 KlangFarben",
      "url": "audio/impressionen/092 klangfarben - dust-on-my-notebook.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Outside \u2022 KlangFarben",
      "full": "Outside \u2022 KlangFarben",
      "url": "audio/impressionen/093 klangfarben - outside.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Entertainer \u2022 KlangFarben",
      "full": "Entertainer \u2022 KlangFarben",
      "url": "audio/impressionen/094 klangfarben - entertainer.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Echo in the Alley \u2022 KlangFarben",
      "full": "Echo in the Alley \u2022 KlangFarben",
      "url": "audio/impressionen/095 klangfarben - echo-in-the-alley.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Frost Waltz \u2022 Kevin MacLeod",
      "full": "Frost Waltz \u2022 Kevin MacLeod",
      "url": "audio/impressionen/096 kevin-macleod - frost-waltz.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100516"
    },
    {
      "name": "What Does Anybody Know About Anything \u2022 Chris Zabriskie",
      "full": "What Does Anybody Know About Anything \u2022 Chris Zabriskie",
      "url": "audio/impressionen/097 chris-zabriskie - what-does-anybody-know-about-anything.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Cipher \u2022 Kevin MacLeod",
      "full": "Cipher \u2022 Kevin MacLeod",
      "url": "audio/impressionen/098 kevin-macleod - cipher.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100844"
    },
    {
      "name": "Rivers of Raga \u2022 KlangFarben",
      "full": "Rivers of Raga \u2022 KlangFarben",
      "url": "audio/impressionen/099 klangfarben - rivers-of-raga.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Merry Go \u2022 Kevin MacLeod",
      "full": "Merry Go \u2022 Kevin MacLeod",
      "url": "audio/impressionen/100 kevin-macleod - merry-go.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100731"
    },
    {
      "name": "Echoes In The Hidden Chamber \u2022 KlangFarben",
      "full": "Echoes In The Hidden Chamber \u2022 KlangFarben",
      "url": "audio/impressionen/101 klangfarben - echoes-in-the-hidden-chamber.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Travel Light \u2022 Audionautix",
      "full": "Travel Light \u2022 Audionautix",
      "url": "audio/impressionen/102 audionautix - travel-light.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Antigravity \u2022 KlangFarben",
      "full": "Antigravity \u2022 KlangFarben",
      "url": "audio/impressionen/103 klangfarben - antigravity.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Steps in the Snow \u2022 KlangFarben",
      "full": "Steps in the Snow \u2022 KlangFarben",
      "url": "audio/impressionen/104 klangfarben - steps-in-the-snow.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Wandering Horizons \u2022 KlangFarben",
      "full": "Wandering Horizons \u2022 KlangFarben",
      "url": "audio/impressionen/105 klangfarben - wandering-horizons.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Silver Spires in Sunmist \u2022 KlangFarben",
      "full": "Silver Spires in Sunmist \u2022 KlangFarben",
      "url": "audio/impressionen/106 klangfarben - silver-spires-in-sunmist.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Scheming Weasel faster \u2022 Kevin MacLeod",
      "full": "Scheming Weasel faster \u2022 Kevin MacLeod",
      "url": "audio/impressionen/107 kevin-macleod - scheming-weasel-faster.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=faster"
    },
    {
      "name": "Night Shift Infiltration \u2022 KlangFarben",
      "full": "Night Shift Infiltration \u2022 KlangFarben",
      "url": "audio/impressionen/108 klangfarben - night-shift-infiltration.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Far Far Away \u2022 Horner",
      "full": "Far Far Away \u2022 Johnathon M. Horner",
      "url": "audio/impressionen/109 johnathon-m-horner - far-far-away.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://freemusicarchive.org/music/beat-mekanik/single/far-far-away/"
    },
    {
      "name": "Mind Scrape \u2022 Kevin MacLeod",
      "full": "Mind Scrape \u2022 Kevin MacLeod",
      "url": "audio/impressionen/110 kevin-macleod - mind-scrape.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://incompetech.com/music/royalty-free/index.html?isrc=USUAN1100616"
    },
    {
      "name": "Hallways of Hidden Stars \u2022 KlangFarben",
      "full": "Hallways of Hidden Stars \u2022 KlangFarben",
      "url": "audio/impressionen/111 klangfarben - hallways-of-hidden-stars.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Bubblegum Skyline \u2022 KlangFarben",
      "full": "Bubblegum Skyline \u2022 KlangFarben",
      "url": "audio/impressionen/112 klangfarben - bubblegum-skyline.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    },
    {
      "name": "Temptation March \u2022 Audionautix",
      "full": "Temptation March \u2022 Audionautix",
      "url": "audio/impressionen/113 audionautix - temptation-march.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.youtube.com/audiolibrary"
    },
    {
      "name": "Clear Skies \u2022 Snoozybeats",
      "full": "Clear Skies \u2022 Snoozybeats",
      "url": "audio/impressionen/114 snoozybeats - clear-skies.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://www.audiolibrary.com.co/snoozybeats/clear-skies"
    },
    {
      "name": "Soft Light Between Us \u2022 KlangFarben",
      "full": "Soft Light Between Us \u2022 KlangFarben",
      "url": "audio/impressionen/115 klangfarben - soft-light-between-us.mp3",
      "start": 0.0,
      "end": null,
      "source": "https://github.com/holl-/VnS/blob/main/Original_Music.md"
    }
  ]
};

// ============================================================================
// COOKIE MANAGEMENT
// ============================================================================

function setCookie(name, value, days = 365){
  const date = new Date();
  date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
  const expires = "expires=" + date.toUTCString();
  document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/;SameSite=Lax";
}

function getCookie(name){
  const nameEQ = name + "=";
  const cookies = document.cookie.split(';');
  for(let i = 0; i < cookies.length; i++){
    let c = cookies[i].trim();
    if (c.indexOf(nameEQ) === 0){
      return decodeURIComponent(c.substring(nameEQ.length));
    }
  }
  return null;
}

function savePlaybackState(){
  const track = tracks[currentIndex];
  if (!track) return;

  const state = {
    trackIndex: currentIndex,
    trackName: track.name,
    majorVersion: PLAYLIST.majorVersion || 0,
    minorVersion: PLAYLIST.minorVersion || 0
  };

  setCookie('vibeSeekState', JSON.stringify(state));
}

function loadPlaybackState(){
  const cookie = getCookie('vibeSeekState');
  if (!cookie) return 0;

  try {
    const state = JSON.parse(cookie);

    // Check if playlist version has changed significantly (major version bump)
    if (state.majorVersion !== undefined &&
        PLAYLIST.majorVersion !== undefined &&
        state.majorVersion !== PLAYLIST.majorVersion){
      // Major version changed, start from beginning
      return 0;
    }

    // Try to find track by name first
    const trackByName = tracks.findIndex(t => t.name === state.trackName);
    if (trackByName !== -1){
      return trackByName;
    }

    // Fall back to index if name not found
    if (state.trackIndex >= 0 && state.trackIndex < tracks.length){
      return state.trackIndex;
    }

    // Default to first track
    return 0;
  } catch(e){
    return 0;
  }
}

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

function detectSource(url){
  if (!url) return null;
  if (url.match(/\.(mp3|ogg|wav)(\?|$)/i)) return 'audio';
  if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
  return null;
}

function idFromUrl(url){
  try {
    const u = new URL(url);
    if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
    if (u.searchParams.get('v')) return u.searchParams.get('v');
  } catch(e){}
  return null;
}

function formatTime(s){
  if (s == null) return '‚Äî';
  s = Math.floor(s);
  const m = Math.floor(s/60), sec = s%60;
  return m+':' + (sec<10? '0'+sec:sec);
}

// ============================================================================
// TRACK DATA SETUP
// ============================================================================

const tracks = (PLAYLIST.tracks || []).map((t, i) => {
  const source = detectSource(t.url);
  return {
    index: i,
    name: t.name || ('Track ' + (i+1)),
    full: `${t.full || (t.name || ('Track ' + (i+1)))} ‚ÄÄ<a target="_blank" class="source-link" href="${t.source || t.url}">‚Üó</a>`,
    source,
    url: t.url,
    videoId: source === 'youtube' ? idFromUrl(t.url) : null,
    start: t.start != null ? Number(t.start) : 0,
    end: t.end != null ? Number(t.end) : null
  };
});

// ============================================================================
// UI SETUP
// ============================================================================

const trackListEl = document.getElementById('trackList');
tracks.forEach(tr => {
  const el = document.createElement('div');
  el.className = 'track';
  el.dataset.index = tr.index;
  el.innerHTML = '<div class="idx">'+(tr.index+1)+'</div><div class="title">'+tr.name.replace(/[&<>]/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[s]))+'</div>';
  el.addEventListener('click', () => playTrack(tr.index, true));
  trackListEl.appendChild(el);
});

// ============================================================================
// PLAYER STATE
// ============================================================================

let ytPlayer = null;
let audioPlayer = null;
let currentIndex = 0;
let loopTimer = null;
let ytApiReady = false;
let ytApiLoading = false;

const bgAudio = new Audio('audio/SFX_Next.mp3');
bgAudio.volume = 1.0;
bgAudio.loop = false;

// ============================================================================
// YOUTUBE API LOADING
// ============================================================================

function loadYouTubeAPI(){
  if (ytApiLoading) return;
  ytApiLoading = true;

  const script = document.createElement('script');
  script.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(script);
}

window.onYouTubeIframeAPIReady = function(){
  ytApiReady = true;
};

// Load YouTube API if needed
if (tracks.some(t => t.source === 'youtube')){
  loadYouTubeAPI();
}

// ============================================================================
// PLAYER MANAGEMENT
// ============================================================================

function createYouTubePlayer(videoId, startSeconds){
  const container = document.getElementById('player-container');
  container.innerHTML = '';

  ytPlayer = new YT.Player('player-container', {
    videoId: videoId,
    width: 500,
    height: 80,
    playerVars: {
      enablejsapi: 1,
      modestbranding: 1,
      rel: 0,
      controls: 1,
      iv_load_policy: 3,
      start: Math.floor(startSeconds || 0)
    },
    events: {
      onReady: (e) => {
        resizePlayer();
        e.target.seekTo(startSeconds || 0, true);
      },
      onStateChange: onYouTubeStateChange
    }
  });

  window.addEventListener('resize', resizePlayer);
}

function createAudioPlayer(){
  if (audioPlayer) return audioPlayer;

  const container = document.getElementById('player-container');
  container.innerHTML = '';

  audioPlayer = document.createElement('audio');
  audioPlayer.controls = true;
  audioPlayer.style.width = '100%';
  audioPlayer.style.height = '56px';
  audioPlayer.preload = 'auto';
  container.appendChild(audioPlayer);

  audioPlayer.addEventListener('play', () => {
    updatePlayButton(true);
    startLoopWatcher();
  });

  audioPlayer.addEventListener('pause', () => {
    updatePlayButton(false);
    stopLoopWatcher();
  });

  audioPlayer.addEventListener('ended', () => {
    // Loop back to start when track ends naturally
    const track = tracks[currentIndex];
    audioPlayer.currentTime = track.start || 0;
    audioPlayer.play().catch(() => {});
  });

  return audioPlayer;
}

function destroyYouTubePlayer(){
  if (ytPlayer && ytPlayer.destroy){
    ytPlayer.destroy();
    ytPlayer = null;
  }
}

function destroyAudioPlayer(){
  if (audioPlayer){
    audioPlayer.pause();
    audioPlayer.src = '';
    audioPlayer = null;
  }
}

function resizePlayer(){
  if (!ytPlayer || !ytPlayer.getIframe) return;
  const wrap = document.getElementById('video-wrap');
  const width = Math.min(500, wrap.clientWidth);
  const height = Math.max(56, Math.round(width * (80/500)));
  const ifr = ytPlayer.getIframe();
  ifr.width = width;
  ifr.height = height;
}

// ============================================================================
// PLAYBACK CONTROL
// ============================================================================

function playTrack(index, autoplay = false){
  if (!tracks[index]) return;

  currentIndex = index;
  highlightActive();
  stopLoopWatcher();
  savePlaybackState();

  const track = tracks[index];

  document.getElementById('trackInfo').innerHTML = track.full;

  if (track.source === 'youtube'){
    playYouTubeTrack(track, autoplay);
  } else if (track.source === 'audio'){
    playAudioTrack(track, autoplay);
  }

  bgAudio.pause()
}

function playYouTubeTrack(track, autoplay){
  // Destroy audio player if it exists
  destroyAudioPlayer();

  // Wait for YouTube API if not ready
  if (!ytApiReady){
    setTimeout(() => playYouTubeTrack(track, autoplay), 100);
    return;
  }

  // Create or update YouTube player
  if (!ytPlayer){
    createYouTubePlayer(track.videoId, track.start);
    if (autoplay){
      setTimeout(() => {
        if (ytPlayer && ytPlayer.playVideo) ytPlayer.playVideo();
      }, 300);
    }
  } else {
    ytPlayer.loadVideoById({
      videoId: track.videoId,
      startSeconds: track.start || 0
    });
    if (autoplay){
      setTimeout(() => {
        if (ytPlayer && ytPlayer.playVideo) ytPlayer.playVideo();
      }, 100);
    } else {
      // Even without autoplay, seek to start position
      setTimeout(() => {
        if (ytPlayer && ytPlayer.seekTo) ytPlayer.seekTo(track.start || 0, true);
      }, 100);
    }
  }
}

function playAudioTrack(track, autoplay){
  // Destroy YouTube player if it exists
  destroyYouTubePlayer();

  // Create or update audio player
  const audio = createAudioPlayer();
  audio.src = track.url;
  audio.currentTime = track.start || 0;

  if (autoplay){
    audio.play();
  }
}

function togglePlayPause(){
  const track = tracks[currentIndex];

  if (track.source === 'youtube' && ytPlayer){
    const state = ytPlayer.getPlayerState();
    if (state === YT.PlayerState.PLAYING){
      ytPlayer.pauseVideo();
    } else {
      // Ensure we're at the correct position before playing
      const currentTime = ytPlayer.getCurrentTime();
      if (currentTime < track.start || (track.end && currentTime >= track.end)){
        ytPlayer.seekTo(track.start || 0, true);
      }
      ytPlayer.playVideo();
    }
  } else if (track.source === 'audio' && audioPlayer){
    if (audioPlayer.paused){
      // Ensure we're at the correct position before playing
      if (audioPlayer.currentTime < track.start || (track.end && audioPlayer.currentTime >= track.end)){
        audioPlayer.currentTime = track.start || 0;
      }
      audioPlayer.play();
    } else {
      audioPlayer.pause();
    }
  } else {
    // Player doesn't exist yet, create it
    playTrack(currentIndex, true);
  }
}

function getCurrentTime(){
  const track = tracks[currentIndex];
  if (track.source === 'youtube' && ytPlayer){
    return ytPlayer.getCurrentTime();
  }
  if (track.source === 'audio' && audioPlayer){
    return audioPlayer.currentTime;
  }
  return 0;
}

function seekTo(seconds){
  const track = tracks[currentIndex];
  if (track.source === 'youtube' && ytPlayer){
    ytPlayer.seekTo(seconds, true);
  }
  if (track.source === 'audio' && audioPlayer){
    audioPlayer.currentTime = seconds;
  }
}

// ============================================================================
// LOOP WATCHER
// ============================================================================

function startLoopWatcher(){
  stopLoopWatcher();
  loopTimer = setInterval(() => {
    const track = tracks[currentIndex];
    const now = getCurrentTime();

    // Loop back to start if we've reached the end
    if (track.end != null && now >= track.end - 0.1){
      seekTo(track.start || 0);

      // For audio, resume playing after seek
      if (track.source === 'audio' && audioPlayer && !audioPlayer.paused){
        audioPlayer.play().catch(() => {});
      }
    }

    // If no end time is set, loop the entire track (for audio)
    if (track.end == null && track.source === 'audio' && audioPlayer){
      if (audioPlayer.ended){
        audioPlayer.currentTime = track.start || 0;
        audioPlayer.play().catch(() => {});
      }
    }

    updateTimeLabel(now, track.end);
  }, 200);
}

function stopLoopWatcher(){
  if (loopTimer){
    clearInterval(loopTimer);
    loopTimer = null;
  }
}

// ============================================================================
// UI UPDATES
// ============================================================================

function highlightActive(){
  document.querySelectorAll('.track').forEach(el => {
    el.classList.toggle('active', Number(el.dataset.index) === currentIndex);
  });
}

var isMusicPlaying = false;

function updatePlayButton(isPlaying){
  isMusicPlaying = isPlaying;
  document.getElementById('playBtn').textContent = isPlaying ? '‚è∏' : '‚ñ∂';
}

function updateTimeLabel(currentTime, endTime){
  const label = document.getElementById('timeLabel');
  label.textContent = formatTime(currentTime) + (endTime ? (' / ' + formatTime(endTime)) : '');
}

function onYouTubeStateChange(event){
  if (event.data === YT.PlayerState.PLAYING){
    updatePlayButton(true);
    startLoopWatcher();
  } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED){
    updatePlayButton(false);
    stopLoopWatcher();

    // Loop back to start when video ends
    if (event.data === YT.PlayerState.ENDED){
      const track = tracks[currentIndex];
      ytPlayer.seekTo(track.start || 0, true);
      ytPlayer.playVideo();
    }
  }
}

// ============================================================================
// BUTTON HANDLERS
// ============================================================================

document.getElementById('prevBtn').onclick = () => {
  playTrack((currentIndex - 1 + tracks.length) % tracks.length, true);
};

let transition = false;

document.getElementById('nextBtn').onclick = () => {
  if (transition){
    transition = false;
    bgAudio.pause();
    togglePlayPause();
    return;
  }
  if (!isMusicPlaying) {
    playTrack((currentIndex + 1) % tracks.length, true);
    return;
  }

  playTrack((currentIndex + 1) % tracks.length, false);
  updatePlayButton(false);

  // Start transition
  transition = true;
  bgAudio.currentTime = 0;
  bgAudio.play()
    .then(() => {
      setTimeout(() => {  // Schedule main track to start
        if (!transition)
          return;
        transition = false;
        const track = tracks[currentIndex];
        if (track.source === 'youtube' && ytPlayer){
          ytPlayer.playVideo();
        } else if (track.source === 'audio' && audioPlayer){
          audioPlayer.play();
        }
      }, 5500);
    })
    .catch(err => {
      console.error('Background audio failed to play:', err);
      // Fallback to main track
      playTrack((currentIndex + 1) % tracks.length, true);
    });
};


document.getElementById('playBtn').onclick = togglePlayPause;

// ============================================================================
// INITIALIZATION
// ============================================================================

// Load saved track position
const savedIndex = loadPlaybackState();

// Load first track (or saved track) without autoplay
if (tracks.length > 0){
  playTrack(savedIndex, false);
}
</script>
</body>
</html>